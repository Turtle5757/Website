<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>Play Game</title>
  <link rel="stylesheet" href="style.css">
  <style>
    .frame-wrap { height: 100vh; display:flex; flex-direction:column; }
    .frame-header { padding:10px; background:var(--surface); display:flex; gap:10px; align-items:center; }
    iframe { flex:1; width:100%; border:none; background:#000; }
  </style>
</head>
<body>
  <div class="frame-wrap">
    <div class="frame-header">
      <a class="btn small" href="index.html">⬅ Back</a>
      <button id="open-new" class="btn small">Open in new tab</button>
      <div id="playing-title" style="font-weight:700"></div>
    </div>

    <iframe id="game-iframe" src=""></iframe>
  </div>

  <script>
    // Increment play count when opening here — called from index or details via link too
    const params = new URLSearchParams(location.search);
    const u = params.get("u");
    const id = params.get("id") || u;
    const title = params.get("t") || "";
    const iframe = document.getElementById("game-iframe");
    const playingTitle = document.getElementById("playing-title");
    iframe.src = u;
    playingTitle.textContent = title ? decodeURIComponent(title) : u;

    // record play in localStorage
    (function registerPlay() {
      if(!u) return;
      const key = "playedCount_v1";
      const data = JSON.parse(localStorage.getItem(key) || "{}");
      data[id] = (data[id] || 0) + 1;
      localStorage.setItem(key, JSON.stringify(data));

      // recently played (store up to 20)
      const recKey = "recentlyPlayed_v1";
      const rp = JSON.parse(localStorage.getItem(recKey) || "[]");
      const now = Date.now();
      // remove existing
      const filtered = rp.filter(r => r.id !== id);
      filtered.unshift({ id, url: u, title: title || u, ts: now });
      localStorage.setItem(recKey, JSON.stringify(filtered.slice(0, 20)));
    })();

    document.getElementById("open-new").addEventListener("click", () => {
      window.open(u, "_blank");
    });

  </script>
</body>
</html>
